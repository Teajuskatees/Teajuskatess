<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplikasi Keuangan Cash & Saldo</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .container {
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      width: 95%;
      max-width: 650px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    input, select, button {
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 12px;
      font-size: 14px;
    }
    button {
      background: #4facfe;
      border: none;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #00c6ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #f4f4f4;
    }
    .income {
      color: green;
      font-weight: bold;
    }
    .expense {
      color: red;
      font-weight: bold;
    }
    .saldo-box {
      margin-top: 15px;
      padding: 12px;
      text-align: center;
      background: #f4f4f4;
      border-radius: 12px;
      font-weight: bold;
      font-size: 16px;
    }
    .rekap {
      margin-top: 10px;
      padding: 10px;
      background: #e9f7ff;
      border-radius: 12px;
      font-size: 14px;
    }
    .logout-btn {
      margin-top: 15px;
      background: red;
      color: #fff;
    }
    canvas {
      margin-top: 20px;
      max-height: 300px;
    }
  </style>
</head>
<body>
  <div class="container" id="loginPage">
    <h2>ðŸ”‘ Login</h2>
    <form id="loginForm">
      <input type="text" id="username" placeholder="Username" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>
  </div>

  <div class="container" id="appPage" style="display:none;">
    <h2>ðŸ’° Catatan Keuangan</h2>
    <form id="form">
      <input type="text" id="deskripsi" placeholder="Deskripsi" required>
      <input type="number" id="jumlah" placeholder="Jumlah" required>
      <input type="date" id="tanggal" required>
      <select id="tipe">
        <option value="pemasukan">Pemasukan</option>
        <option value="pengeluaran">Pengeluaran</option>
      </select>
      <select id="sumber">
        <option value="cash">Cash</option>
        <option value="saldo">Saldo Bank</option>
      </select>
      <button type="submit">Tambah</button>
    </form>

    <table>
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>Deskripsi</th>
          <th>Jumlah</th>
          <th>Tipe</th>
          <th>Sumber</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="tabel-body"></tbody>
    </table>

    <div class="saldo-box" id="saldoCash">Saldo Cash: Rp 0</div>
    <div class="saldo-box" id="saldoBank">Saldo Bank: Rp 0</div>
    <div class="rekap" id="rekap-mingguan">Rekap Mingguan: Rp 0</div>
    <div class="rekap" id="rekap-bulanan">Rekap Bulanan: Rp 0</div>
    <div class="rekap" id="rekap-pengeluaran-bulanan">Total Pengeluaran Bulanan: Rp 0</div>

    <canvas id="grafik"></canvas>
    <button id="downloadPDF">ðŸ“„ Download PDF</button>
    <button class="logout-btn" id="logout">Logout</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script>
    const loginPage = document.getElementById("loginPage");
    const appPage = document.getElementById("appPage");
    const loginForm = document.getElementById("loginForm");
    const logoutBtn = document.getElementById("logout");

    loginForm.addEventListener("submit", e => {
      e.preventDefault();
      localStorage.setItem("loggedIn", "true");
      showApp();
    });
    logoutBtn.addEventListener("click", () => {
      localStorage.removeItem("loggedIn");
      location.reload();
    });
    function showApp() {
      loginPage.style.display = "none";
      appPage.style.display = "block";
    }
    if(localStorage.getItem("loggedIn") === "true") {
      showApp();
    }

    const form = document.getElementById("form");
    const deskripsi = document.getElementById("deskripsi");
    const jumlah = document.getElementById("jumlah");
    const tanggal = document.getElementById("tanggal");
    const tipe = document.getElementById("tipe");
    const sumber = document.getElementById("sumber");
    const tabelBody = document.getElementById("tabel-body");
    const saldoCash = document.getElementById("saldoCash");
    const saldoBank = document.getElementById("saldoBank");
    const rekapMingguan = document.getElementById("rekap-mingguan");
    const rekapBulanan = document.getElementById("rekap-bulanan");
    const rekapPengeluaranBulanan = document.getElementById("rekap-pengeluaran-bulanan");
    const ctx = document.getElementById("grafik").getContext("2d");

    let transaksi = JSON.parse(localStorage.getItem("transaksi")) || [];

    form.addEventListener("submit", function(e) {
      e.preventDefault();
      const data = {
        id: Date.now(),
        desc: deskripsi.value,
        amount: parseInt(jumlah.value),
        type: tipe.value,
        source: sumber.value,
        date: new Date(tanggal.value)
      };
      transaksi.push(data);
      localStorage.setItem("transaksi", JSON.stringify(transaksi));
      updateUI();
      form.reset();
    });

    function hapusTransaksi(id) {
      transaksi = transaksi.filter(t => t.id !== id);
      localStorage.setItem("transaksi", JSON.stringify(transaksi));
      updateUI();
    }

    function updateUI() {
      tabelBody.innerHTML = "";
      let cash = 0, bank = 0;
      const now = new Date();
      const awalMinggu = new Date(now); awalMinggu.setDate(now.getDate() - now.getDay());
      const awalBulan = new Date(now.getFullYear(), now.getMonth(), 1);
      let totalMinggu = 0, totalBulan = 0, totalPengeluaranBulan = 0;

      transaksi.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${item.date ? new Date(item.date).toLocaleDateString("id-ID") : ""}</td>
          <td>${item.desc}</td>
          <td class="${item.type === "pemasukan" ? "income" : "expense"}">Rp ${item.amount.toLocaleString()}</td>
          <td>${item.type}</td>
          <td>${item.source}</td>
          <td><button onclick="hapusTransaksi(${item.id})">Hapus</button></td>
        `;
        tabelBody.appendChild(row);

        if(item.type === "pemasukan") {
          if(item.source === "cash") cash += item.amount; else bank += item.amount;
        } else {
          if(item.source === "cash") cash -= item.amount; else bank -= item.amount;
        }

        const d = new Date(item.date);
        if(d >= awalMinggu && d <= now) {
          totalMinggu += item.type === "pemasukan" ? item.amount : -item.amount;
        }
        if(d >= awalBulan && d <= now) {
          totalBulan += item.type === "pemasukan" ? item.amount : -item.amount;
          if(item.type === "pengeluaran") totalPengeluaranBulan += item.amount;
        }
      });

      saldoCash.textContent = "Saldo Cash: Rp " + cash.toLocaleString();
      saldoBank.textContent = "Saldo Bank: Rp " + bank.toLocaleString();
      rekapMingguan.textContent = "Rekap Mingguan: Rp " + totalMinggu.toLocaleString();
      rekapBulanan.textContent = "Rekap Bulanan: Rp " + totalBulan.toLocaleString();
      rekapPengeluaranBulanan.textContent = "Total Pengeluaran Bulanan: Rp " + totalPengeluaranBulan.toLocaleString();

      if(window.grafikChart) window.grafikChart.destroy();
      window.grafikChart = new Chart(ctx, {
        type: "pie",
        data: {
          labels: ["Cash", "Bank"],
          datasets: [{
            data: [cash, bank],
            backgroundColor: ["#4caf50", "#2196f3"]
          }]
        }
      });
    }

    updateUI();

    document.getElementById("downloadPDF").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("Laporan Keuangan", 14, 20);

      const pemasukan = transaksi.filter(t => t.type === "pemasukan").map(t => [
        new Date(t.date).toLocaleDateString("id-ID"),
        t.desc,
        "Rp " + t.amount.toLocaleString(),
        t.source
      ]);
      const pengeluaran = transaksi.filter(t => t.type === "pengeluaran").map(t => [
        new Date(t.date).toLocaleDateString("id-ID"),
        t.desc,
        "Rp " + t.amount.toLocaleString(),
        t.source
      ]);

      doc.autoTable({
        head: [["Tanggal", "Deskripsi", "Jumlah", "Sumber"]],
        body: pemasukan,
        startY: 30,
        theme: "grid",
        headStyles: { fillColor: [76, 175, 80] },
        didDrawPage: (data) => {
          doc.text("Tabel Pemasukan", 14, 28);
        }
      });

      let finalY = doc.lastAutoTable.finalY + 10;
      doc.autoTable({
        head: [["Tanggal", "Deskripsi", "Jumlah", "Sumber"]],
        body: pengeluaran,
        startY: finalY,
        theme: "grid",
        headStyles: { fillColor: [244, 67, 54] },
        didDrawPage: (data) => {
          doc.text("Tabel Pengeluaran", 14, finalY - 2);
        }
      });

      doc.save("laporan_keuangan.pdf");
    });
  </script>
</body>
</html>
